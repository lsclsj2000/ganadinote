<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/communityLayoutView}">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<title>ì»¤ë®¤ë‹ˆí‹°</title>
	<link th:href="@{/assets/css/bootstrap.css}" href="/assets/css/bootstrap.css" rel="stylesheet"/>
	<th:block layout:fragment="pageStyles">
		<style>
			.mobile-wrap {
				max-width: 460px;
				margin: auto;
			}

			.sticky-topbar {
				position: sticky;
				top: 0;
				border-bottom: 1px solid #eee;
				z-index: 1;
				padding: .5rem;
			}

			.sticky-topbar .d-flex {
				margin-bottom: .5rem;
			}

			.chip-scroll {
				overflow-x: auto;
				white-space: nowrap;
				-webkit-overflow-scrolling: touch;
				padding-bottom: .3rem;
				margin-bottom: .6rem;
			}

			.chip {
				display: inline-block;
				padding: .45rem .9rem;
				margin-right: .4rem;
				border: 1px solid #ddd;
				border-radius: 999px;
				font-size: .95rem;
				background: #f8f9fa;
			}

			.chip.active {
				background: #e9ecef;
				font-weight: 600;
			}

			.post-card {
				border-bottom: 1px solid #f1f1f1;
				padding: 20px 8px;
			}

			.fab {
				position: fixed;
				right: 16px;
				bottom: calc(var(--footer-h) + 16px);
				z-index: 1;
			}

			.card-text {
				font-size: 0.7rem;
				color: #6c757d;
			}

			.small {
				font-size: 0.7rem;
			}
		</style>
	</th:block>
</head>

<body>
	<th:block layout:fragment="contents">
		<div class="mobile-wrap">
			<!-- ìƒë‹¨ ê²€ìƒ‰ + ì •ë ¬ -->
			<div class="sticky-topbar p-2">
				<div class="d-flex gap-2">
				  <select class="form-select form-select-sm" style="max-width:120px" name="sort">
				    <option th:value="latest"   th:selected="${param.sort ?: 'latest'} == 'latest'">ìµœì‹ ìˆœ</option>
				    <option th:value="popular"  th:selected="${param.sort} == 'popular'">ì¸ê¸°ìˆœ</option>
				    <option th:value="comments" th:selected="${param.sort} == 'comments'">ëŒ“ê¸€ë§ì€ìˆœ</option>
				  </select>
				  <input type="search"
				         class="form-control form-control-sm"
				         name="q"
				         placeholder="ê²€ìƒ‰(ì œëª©/ì‘ì„±ì)"
				         th:value="${param.q}">
				</div>
				<!-- ì¹´í…Œê³ ë¦¬ ì¹© -->
				<div class="chip-scroll mt-2 pb-1" id="catChips">
				  <button class="chip"
				          data-cat=""
				          th:classappend="${#strings.isEmpty(param.categoryId)} ? ' active'">ì „ì²´</button>

				  <button class="chip" data-cat="1"
				          th:classappend="${param.categoryId} == '1' ? ' active'">ë°œìêµ­ ì‚°ì±…ì½”ìŠ¤</button>

				  <button class="chip" data-cat="2"
				          th:classappend="${param.categoryId} == '2' ? ' active'">ë©ë© ì‡¼í•‘ë¦¬ë·°</button>

				  <button class="chip" data-cat="3"
				          th:classappend="${param.categoryId} == '3' ? ' active'">ë©ë© ìˆ˜ë‹¤ë°©</button>

				  <button class="chip" data-cat="4"
				          th:classappend="${param.categoryId} == '4' ? ' active'">ì‚°ì±…í¬ë£¨ ëª¨ì§‘í•´ìš”!</button>

				  <button class="chip" data-cat="5"
				          th:classappend="${param.categoryId} == '5' ? ' active'">ê°™ì´ê°€ìš” ìŠ¤íŒŸ</button>
				</div>
			</div>

			<!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ -->
			<div id="list">
				<div th:if="${#lists.isEmpty(post)}"
				       class="text-center text-muted py-4">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>

				  <!-- ëª©ë¡ ë Œë”ë§ -->
				  <div th:each="p : ${post}" class="post-card card mb-3">
				    <div class="card-body">
				      <a class="stretched-link"
				         th:href="@{/community/postDetail(postId=${p.postId})}"></a>

				      <span class="badge bg-secondary mb-3"
				            th:text="${p.categoryNm}">ì¹´í…Œê³ ë¦¬</span>

				      <h6 th:text="${p.postTtl}">ì œëª©</h6>

					  <p class="card-text text-truncate"
					     th:text="${p.postCtnt} ?: ''">ë¯¸ë¦¬ë³´ê¸°</p>

					 <div class="post-meta small text-muted">
					   <div th:text="${p.mbrNknm}">ì‘ì„±ì</div>
					   <div th:text="${#temporals.format(p.postRegDate, 'yyyy.MM.dd HH:mm')}">2025.08.26 18:45</div>
					   <div th:text="'ì¡°íšŒ ' + ${p.postViewCount}">ì¡°íšŒ 10</div>
					 </div>

				      <div class="d-flex justify-content-end gap-3 mt-2">
				        <span>ğŸ‘ <span th:text="${p.postLikeCount}">0</span></span>
				        <span>ğŸ’¬ <span th:text="${p.cmtCount}">0</span></span>
				      </div>
				    </div>
				  </div>
				</div>

			<!-- ë”ë³´ê¸° ë²„íŠ¼ -->
			<div class="p-3 text-center">
				<button class="btn btn-outline-secondary btn-sm w-100">ë”ë³´ê¸°</button>
			</div>
		</div>

		<!-- ìƒˆ ê¸€ ì“°ê¸° ë²„íŠ¼ -->
		<div class="fab">
			<a th:href="@{/community/addPost}" class="btn btn-primary rounded-pill px-3 py-2">ê¸€ì“°ê¸°</a>
		</div>
	</th:block>
	<th:block layout:fragment="pageScripts">
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<script>
			function fmt(iso){
			  if(!iso) return '';
			  const d = new Date(iso);
			  const z = n => String(n).padStart(2,'0');
			  return `${d.getFullYear()}.${z(d.getMonth()+1)}.${z(d.getDate())} ${z(d.getHours())}:${z(d.getMinutes())}`;
			}

			function renderPosts(posts){
			  if(!posts || posts.length===0){
			    return '<div class="text-center text-muted py-4">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
			  }
			  return posts.map(function(p){
			    return `
			      <div class="post-card card mb-3">
			        <div class="card-body">
			          <a class="stretched-link" href="/community/postDetail?postId=${p.postId}"></a>
			          <span class="badge bg-secondary mb-3">${p.categoryNm ?? ''}</span>
			          <h6>${p.postTtl ?? ''}</h6>
			          <p class="card-text text-truncate">${p.postCtnt ?? ''}</p>
			          <div class="post-meta small text-muted">
			            <div>${p.mbrNknm ?? ''}</div>
			            <div>${fmt(p.postRegDate)}</div>
			            <div>ì¡°íšŒ ${p.postViewCount ?? 0}</div>
			          </div>
			          <div class="d-flex justify-content-end gap-3 mt-2">
			            <span>ğŸ‘ ${p.postLikeCount ?? 0}</span>
			            <span>ğŸ’¬ ${p.cmtCount ?? 0}</span>
			          </div>
			        </div>
			      </div>`;
			  }).join('');
			}
	
		  // ì¹© ë˜í¼ì— id ë‹¬ì•„ë‘ê¸°: <div class="chip-scroll ..." id="catChips">
		  $(function(){
		    $('#catChips').on('click', '.chip', function(){
		      var $btn = $(this);
		      var categoryId = $btn.data('cat'); // '' ë˜ëŠ” '1'~'5'
	
		      $('.chip').removeClass('active');
		      $btn.addClass('active');
	
		      $('#list').html('<div class="text-center text-muted py-4">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>');
	
		      // ì •ë ¬/ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ìœ ì§€í•˜ê³  categoryIdë§Œ ê°±ì‹ í•´ì„œ í˜¸ì¶œí•˜ê³  ì‹¶ìœ¼ë©´:
		      var params = new URLSearchParams(window.location.search);
		      if(categoryId !== undefined && categoryId !== '') params.set('categoryId', categoryId);
		      else params.delete('categoryId');
	
		      $.getJSON('/community/api/list', Object.fromEntries(params.entries()))
		        .done(function(posts){ $('#list').html(renderPosts(posts)); })
		        .fail(function(){ $('#list').html('<div class="text-center text-danger py-4">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>'); });
		    });
		  });
		</script>
	</th:block>
</body>

</html>