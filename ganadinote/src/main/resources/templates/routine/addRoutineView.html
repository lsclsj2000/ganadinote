<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	layout:decorate="~{layout/mainLayoutView}">
<head>
<title>새 루틴 추가</title>
<link rel="stylesheet" href="/assets/css/routine/routine.css">
</head>
<div layout:fragment="contents">
	<div class="routine-add-page">
		<div class="page-heading">
			<h3>새로운 루틴 추가</h3>
		</div>

		<form th:action="@{/routine/add}" method="post">
			<input type="hidden" name="mbrCd" value="1">

			<div class="form-group">
				<label>대상 강아지</label> <select name="petCd" class="form-control">
					<option th:each="pet : ${pets}" th:value="${pet.petCd}"
						th:text="${pet.petName}"></option>
				</select>
			</div>
			<div class="form-group">
				<label>루틴 제목</label> <input type="text" name="routineTitle"
					class="form-control" required>
			</div>
			<div class="form-group">
				<label>반복 타입</label>
				<!-- [수정 1] id를 부여하고, onchange 이벤트를 추가합니다. -->
				<select name="routineRepeatType" id="repeatType"
					class="form-control" onchange="toggleRepeatDetail()">
					<option value="DAILY">매일</option>
					<option value="WEEKLY">매주</option>
					<option value="MONTHLY">매월</option>
				</select>
			</div>

			<!-- ====================================================================== -->
			<!-- ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ 이 부분이 핵심 수정사항입니다 ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ -->
			<!-- ====================================================================== -->

			<!-- [추가!] '매주' 선택 시 보여질 요일 선택 UI -->
			<div id="weeklyDetail" class="form-group" style="display: none;">
				<label>반복 요일</label> <select name="routineDayOfWeek"
					class="form-control">
					<option value="1">월요일</option>
					<option value="2">화요일</option>
					<option value="3">수요일</option>
					<option value="4">목요일</option>
					<option value="5">금요일</option>
					<option value="6">토요일</option>
					<option value="7">일요일</option>
				</select>
			</div>

			<!-- [추가!] '매월' 선택 시 보여질 날짜 선택 UI -->
			<div id="monthlyDetail" class="form-group" style="display: none;">
				<label>반복 날짜</label> <input type="number" name="routineDayOfMonth"
					class="form-control" min="1" max="31"
					placeholder="1~31 사이의 숫자를 입력하세요">
			</div>

			<!-- ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲ -->
			<!-- ====================================================================== -->

			<div class="form-group">
				<label>수행 시간 (선택)</label> <input type="time" name="routineTimeOfDay"
					class="form-control">
			</div>
			<div class="form-group">
				<label>루틴 시작일</label> <input type="date" name="routineStartDate"
					class="form-control" required>
			</div>
			<div class="form-group">
				<label>루틴 종료일</label> <input type="date" name="routineEndDate"
					class="form-control" required>
			</div>

			<button type="submit" class="btn btn-primary">저장하고 할 일 생성하기</button>
		</form>
	</div>

	<!-- [수정!] UI를 동적으로 제어할 JavaScript -->
	<script>
		document.addEventListener('DOMContentLoaded', toggleRepeatDetail);

		function toggleRepeatDetail() {
			const repeatTypeSelect = document.getElementById('repeatType');
			const weeklyDetailDiv = document.getElementById('weeklyDetail');
			const monthlyDetailDiv = document.getElementById('monthlyDetail');

			// [추가!] 각 입력 필드를 변수로 가져옵니다.
			const dayOfWeekSelect = weeklyDetailDiv
					.querySelector('select[name="routineDayOfWeek"]');
			const dayOfMonthInput = monthlyDetailDiv
					.querySelector('input[name="routineDayOfMonth"]');

			const selectedType = repeatTypeSelect.value;

			// '매주'를 선택했을 때
			if (selectedType === 'WEEKLY') {
				weeklyDetailDiv.style.display = 'block';
				dayOfWeekSelect.required = true; // 필수 입력으로 설정
			} else {
				weeklyDetailDiv.style.display = 'none';
				dayOfWeekSelect.required = false; // 필수 입력 해제
			}

			// '매월'을 선택했을 때
			if (selectedType === 'MONTHLY') {
				monthlyDetailDiv.style.display = 'block';
				dayOfMonthInput.required = true; // 필수 입력으로 설정
			} else {
				monthlyDetailDiv.style.display = 'none';
				dayOfMonthInput.required = false; // 필수 입력 해제
			}
		}
	</script>
</div>
</html>