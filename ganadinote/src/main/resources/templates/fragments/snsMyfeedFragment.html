<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="snsMyfeedFragment">
	<div class="mt-10">
        <section class="section">
            <div class="row no-gutter-x justify-content-center">
                <div class="col-12 col-md-8">
                    <div class="card mb-2">
                        <div class="card-body">
                            <!-- 1. 원형 프로필사진 -->
                            <div class="sr_profile-container">
                                <div class="avatar avatar-xl mb-3">
								  	<img th:src="${profileImg != null and !#strings.isEmpty(profileImg) 
								                   ? profileImg 
								                   : '/assets/images/samples/dogdefault.png'}" 
								         alt="프로필 사진">
								</div>
                                <h5 th:text="${displayName}">사용자</h5>
                                <div class="sr_profile-stats">
									<div class="sr_profile-stat-item">
										<strong th:text="${postCount}">게시물 숫자</strong>
										<span>게시물</span>
									</div>
									
									<!-- 팔로워: 클릭 시 모달 + 팔로워 탭 기본 -->
									<button type="button"
									        class="sr_profile-stat-item sr_stat-link"
									        data-bs-toggle="modal"
									        data-bs-target="#srFollowModal"
									        data-follow-tab="followers">
										<strong style="color: #607080;" th:text="${followerCount}">팔로워 숫자</strong>
										<span>팔로워</span>
									</button>
									
									<!-- 팔로우: 클릭 시 모달 + 팔로우 탭 기본 -->
									<button type="button"
									        class="sr_profile-stat-item sr_stat-link"
									        data-bs-toggle="modal"
									        data-bs-target="#srFollowModal"
									        data-follow-tab="following">
										<strong style="color: #607080;" th:text="${followingCount}">팔로우 숫자</strong>
										<span>팔로우</span>
									</button>
								</div>
                                <!-- 내 페이지일 때 -->
								<div class="sr_profile-buttons" th:if="${isOwner}">
									<a th:href="@{/sns/updateProfile}" class="sr_btn-profile">프로필 수정</a>
									<a th:href="@{/sns/addSnsPost}" class="sr_btn-profile">게시물 업로드</a>
								</div>
								
								<!-- 남의 페이지일 때 -->
								<div class="sr_profile-buttons" th:if="${!isOwner}">
									<!-- 펫 프로필 카드: 라우트는 원하는 곳으로 연결 -->
									<a th:href="@{/sns/petcards(m=${viewMbrCd})}" class="sr_btn-profile">펫 프로필 카드</a>
								
								  <!-- 팔로우/취소 -->
								  <button id="btnFollow"
								          class="sr_btn-profile"
								          type="button"
								          th:attr="data-target=${viewMbrCd}"
								          th:text="${isFollowing} ? '팔로우 취소' : '팔로우'">
								    팔로우
								  </button>
								</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. 올린 게시물(박스형태 1행 3열) -->
            <div class="row no-gutter-x justify-content-center mb-3">
                <div class="col-12 col-md-8 mb-4">
					<div class="sr_feed-post-grid">
						<div class="sr_feed-post-item"
						     th:each="p : ${myPosts}"
						     data-bs-toggle="modal"
						     data-bs-target="#srPostModal"
						     th:attr="data-image-src=@{${p.repImagePath}},
						              data-post-date=${#temporals.format(p.spRegYmdt, 'M월 d일')},
						              data-feed-id=${p.spCd},
						              data-tags=${p.spCn != null ? p.spCn.replaceAll('\\s+','') : ''}">
						  <img th:if="${p.repImagePath != null}" th:src="@{${p.repImagePath}}" alt="게시물 이미지">
						</div>
					</div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- 팔로워/팔로우 공용 모달 -->
	<div class="modal fade" id="srFollowModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered sr_custom-modal-dialog">
			<div class="modal-content sr_custom-modal-content">
				<div class="modal-header sr_custom-modal-header">
					<h5 class="modal-title">친구 목록</h5>
					<button type="button" class="btn-close sr_custom-btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
				</div>
	
				<div class="modal-body sr_custom-modal-body">
					<!-- 탭 -->
					<ul class="nav nav-tabs sr_custom-nav-tabs" id="srFollowTabs" role="tablist">
						<li class="nav-item" role="presentation">
							<button class="nav-link active"
							        id="srFollowersTabBtn"
							        data-bs-toggle="tab"
							        data-bs-target="#srFollowersTab"
							        type="button" role="tab" aria-controls="srFollowersTab" aria-selected="true">
							  팔로워
							</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link"
							        id="srFollowingTabBtn"
							        data-bs-toggle="tab"
							        data-bs-target="#srFollowingTab"
							        type="button" role="tab" aria-controls="srFollowingTab" aria-selected="false">
							  팔로우
							</button>
						</li>
					</ul>
	
					<!-- 탭 콘텐츠 -->
					<div class="tab-content mt-3">
						<!-- 팔로워 탭 -->
						<div class="tab-pane fade show active" id="srFollowersTab" role="tabpanel" aria-labelledby="srFollowersTabBtn">
							<ul class="sr_follow-list">
								<li th:if="${#lists.isEmpty(followers)}" class="text-center text-muted py-3">팔로워가 없습니다.</li>
								
								<li class="sr_follow-item" th:each="u : ${followers}">
									<a th:href="@{/sns/myfeed(m=${u.mbrCd})}" class="d-flex align-items-center text-reset text-decoration-none">
										<div class="avatar avatar-md">
										    <img th:src="${u.profilePath != null and !#strings.isEmpty(u.profilePath) 
									                      ? u.profilePath 
									                      : '/assets/images/samples/dogdefault.png'}" 
									           alt="프로필">
										</div>
										<div class="sr_follow-meta">
											<div class="sr_follow-name" th:text="${u.nickname}">닉네임</div>
											<div class="sr_follow-sub"  th:text="${u.handle}">@id</div>
										</div>
									</a>
									<div class="sr_feed-actions d-flex align-items-center mb-2">
										<i class="bi bi-heart text-danger"></i>
									</div>
								</li>
							</ul>
						</div>
	
						<!-- 팔로우 탭 -->
						<div class="tab-pane fade" id="srFollowingTab" role="tabpanel" aria-labelledby="srFollowingTabBtn">
							<ul class="sr_follow-list">
								<li th:if="${#lists.isEmpty(followings)}" class="text-center text-muted py-3">팔로우한 계정이 없습니다.</li>
								
								<li class="sr_follow-item" th:each="u : ${followings}">
									<a th:href="@{/sns/myfeed(m=${u.mbrCd})}" class="d-flex align-items-center text-reset text-decoration-none">
										<div class="avatar avatar-md">
											<img th:src="${u.profilePath != null and !#strings.isEmpty(u.profilePath) 
									                      ? u.profilePath 
									                      : '/assets/images/samples/dogdefault.png'}" 
									           alt="프로필">
										</div>
										<div class="sr_follow-meta">
											<div class="sr_follow-name" th:text="${u.nickname}">닉네임</div>
											<div class="sr_follow-sub"  th:text="${u.handle}">@id</div>
										</div>
									</a>
									<div class="sr_feed-actions d-flex align-items-center mb-2">
										<i class="bi bi-heart text-danger"></i>
									</div>
								</li>
							</ul>
						</div>
	        		</div>
	      		</div>
			</div>
		</div>
	</div>
	
	<!-- 게시물 상세 모달 (새로 추가) -->
    <div class="modal fade" id="srPostModal" tabindex="-1" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered sr_custom-modal-dialog sr_post-modal-dialog">
	    <div class="modal-content sr_custom-modal-content" style="height:auto;">
	      <div class="modal-body p-0" id="srPostModalBody"><!-- 여기로 카드 HTML 주입 --></div>
	    </div>
	  </div>
	</div>
</div>
</html>